<p align="center">
    <img src="http://cdn.tycoding.cn/MIK-WxRzP9.png" />
</p>
<p align="center">
    <a href="https://github.com/Tumo-Team" target="_blank">
        <strong>Tumo Team —— Tumo-Boot</strong>
    </a>
</p>



- Tumo-Boot演示地址：[http://boot.tycoding.cn](http://boot.tycoding.cn)
- Tumo-Boot在线文档：[http://docs.boot.tycoding.cn](http://docs.boot.tycoding.cn)
- Tumo-Boot后端地址：[https://github.com/Tumo-Team/Tumo-Boot](https://github.com/Tumo-Team/Tumo-Boot)
- Tumo-Boot前端地址：[https://github.com/Tumo-Team/Tumo-Boot-UI](https://github.com/Tumo-Team/Tumo-Boot-UI)
- Tumo-Boot文档地址：[https://github.com/Tumo-Team/Tumo-Boot-Docs](https://github.com/Tumo-Team/Tumo-Boot-Docs)

# Vue组件交互

在上一篇文章中，我们介绍了新建页面，在这篇文章中，我们将介绍前端如何进行常见的页面组件交互。

首先，需要调整之前创建的`test`页面文件结构，并修改Router配置如下：

![image-20210322133029118](http://cdn.tycoding.cn/20210322133029.png)

Tips：其中`redirect`可以指定重定向地址，这样对于单层节点`path`可以设为`/`

## 创建Edit弹窗

从实际场景出发，我们一般在Index组件中只写 **列表（分页）查询** 的代码，而对于新增、修改的弹窗页面，一般会单独创建组件并在Index页面引用。那么这些弹窗页面就涉及到了Vue组件交互部分的技术。下面文章将以实际场景出发，以最简单的案例说明父子组件间如何交互。

实际上，新增和编辑操作实际上区别仅仅是 新增没有ID、编辑有ID。因此，我一般会将新增和编辑组件公用，涉及区别的地方再进行显示或隐藏。

如下，在`./components/`目录下创建`EditForm`组件：

![image-20210322133718338](http://cdn.tycoding.cn/20210322133718.png)

如上，相信用过Vue的同学应该很容易理解上述代码。

那么，我们再看`/test`页面：

![image-20210322133740930](http://cdn.tycoding.cn/20210322133740.png)

如上，`EditForm`组件已经成功引入。

下面，简单编写AntV弹窗代码：官方文档：[https://www.antdv.com/components/modal-cn/](https://www.antdv.com/components/modal-cn/)

## 组件交互

### 父组件调用子组件

![image-20210322134619227](http://cdn.tycoding.cn/20210322134619.png)

如上：

- 对于`EditForm`组件，核心是在添加弹窗组件后，要提供一个入口函数`init()`用于触发弹窗打开
- 对于`Index`组件，核心是为**子组件**添加`ref`属性，并且提供一个入口触发调用子组件（这里以按钮为例）。**最重要的是在触发事件中通过`$refs`属性调用子组件中特定的函数**

如上，`$refs`这种方式可避免使用`watch()`监听父组件的调用，并且`visible`只需由子组件维护即可。

![image-20210322140305939](http://cdn.tycoding.cn/20210322140306.png)

### 子组件通知父组件

在实际场景中，如果子组件新增/修改数据完毕后，需要通知父组件刷新Table，下面将演示这个功能。

![image-20210322140558552](http://cdn.tycoding.cn/20210322140558.png)

如上：

- 对于`index`组件，需要在使用子组件时，同时定义一个触发方法`refresh`，它对应了父组件内部的`fetchData()`函数
- 对于`EditForm`组件，需要在弹窗提交关闭时，通过`$emit`属性调用父组件`index`中定义的`refresh`方法

再看页面效果：

![image-20210322140620285](http://cdn.tycoding.cn/20210322140620.png)

## 新增or编辑

之前提到过，我一般会将新增和编辑弹窗公用，因此需要区别当前触发的新增操作还是编辑操作，这里提供一个很简单的方式：

![image-20210322141048193](http://cdn.tycoding.cn/20210322141048.png)

如上，在子组件`init`方法参数列表增加一个`id`，并判断传入的值即可，看下面效果：

![image-20210322141204519](http://cdn.tycoding.cn/20210322141204.png)



# 联系

- 个人博客：[http://tycoding.cn](http://tycoding.cn)
- 微信公众号：程序员涂陌
- QQ交流群：866685601

